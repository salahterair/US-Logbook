<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clinical Ultrasound Practice I • Digital Logbook</title>
  <style>
    :root{
      --bg:#f5f8ff;
      --fg:#0f172a;
      --card:#ffffff;
      --accent:#0055cc;
      --accent-soft:#e6eefc;
      --border:#ccd6f6;
      --muted:#4a5d80;
    }
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:var(--bg);
      color:var(--fg);
      padding:12px;
    }
    .container{
      max-width:960px;
      margin:0 auto;
    }
    header{text-align:center;margin-bottom:16px;}
    header img{width:85px;margin-bottom:6px;display:block;margin-left:auto;margin-right:auto;}
    header h1{margin:0;font-size:1.7rem;font-weight:700;color:#003399;}
    header p{margin:2px 0;color:var(--muted);font-size:0.9rem;}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      box-shadow:0 8px 20px rgba(0,51,153,0.06);
      margin-bottom:16px;
    }
    .tabs{
      display:flex;
      flex-wrap:wrap;
      border-bottom:1px solid var(--border);
      margin-bottom:12px;
      gap:4px;
    }
    .tab-btn{
      border:none;
      background:transparent;
      padding:8px 12px;
      border-radius:999px;
      cursor:pointer;
      font-size:0.9rem;
      color:var(--muted);
    }
    .tab-btn.active{
      background:var(--accent-soft);
      color:var(--accent);
      font-weight:600;
    }
    .tab-panel{display:none;}
    .tab-panel.active{display:block;}
    h2{font-size:1.2rem;margin-bottom:8px;color:#003399;}
    h3{font-size:1rem;margin:10px 0 4px;color:#003399;}
    label{display:block;font-size:0.85rem;margin-top:6px;margin-bottom:2px;font-weight:500;}
    input[type="text"],input[type="date"],input[type="time"],select,textarea{
      width:100%;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid var(--border);
      font-size:0.85rem;
    }
    textarea{min-height:80px;resize:vertical;}
    table{
      width:100%;
      border-collapse:collapse;
      font-size:0.8rem;
      margin-bottom:12px;
    }
    th,td{
      border:1px solid var(--border);
      padding:6px;
      text-align:left;
    }
    th{background:#dbe7ff;font-weight:600;color:#003399;}
    .btn-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;}
    .btn{
      border:none;
      border-radius:999px;
      padding:6px 12px;
      font-size:0.85rem;
      cursor:pointer;
      background:var(--accent);
      color:#fff;
    }
    .btn.outline{
      background:#fff;
      color:var(--accent);
      border:1px solid var(--accent);
    }
    .btn.danger{
      background:#fff0f0;
      color:#b00020;
      border:1px solid #b00020;
    }
    .hint{font-size:0.75rem;color:var(--muted);margin-top:2px;}
    .two-col{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:10px 16px;
    }
    @media (max-width:600px){
      header h1{font-size:1.35rem;}
      .tabs{flex-direction:column;align-items:flex-start;}
      .tab-btn{width:100%;text-align:left;}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
     <img src="assets/logo.png"
     alt="University of Sinnar Logo"
     style="width:85px;margin-bottom:6px;display:block;margin-left:auto;margin-right:auto;">

      <h1>Clinical Ultrasound Practice I – Digital Logbook</h1>
      <p>Master of Diagnostic Medical Ultrasound • University of Sinnar</p>
      <p class="hint">If you have any inquiries, please reach out to Dr. Salaheldin Terair: salahsud@gmail.com.</p>
    </header>

    <div class="card">
      <div class="tabs">
        <button class="tab-btn active" data-tab="student">Student Info</button>
        <button class="tab-btn" data-tab="attendance">Attendance</button>
        <button class="tab-btn" data-tab="cases">Case Log</button>
        <button class="tab-btn" data-tab="weekly">Weekly Reflections</button>
        <button class="tab-btn" data-tab="mid">Competency Checklists</button>
        <button class="tab-btn" data-tab="final">Final Evaluation</button>
        <button class="tab-btn" data-tab="export">Save / Reset</button>
      </div>

      <!-- Student Info -->
      <div class="tab-panel active" id="tab-student">
        <h2>Student & Rotation Information</h2>
        <div class="two-col">
          <div>
            <label>Student Name</label><input type="text" id="s-name">
            <label>Batch</label><input type="text" id="s-batch">
            <label>University Number</label><input type="text" id="s-number">
          </div>
          <div>
            <label>Training Site / Center</label><input type="text" id="s-site">
            <label>Supervisor Name</label><input type="text" id="s-supervisor">
            <label>Rotation Dates</label>
            <div class="two-col" style="grid-template-columns:1fr 1fr;gap:8px;">
              <div><input type="date" id="s-start" placeholder="Start"></div>
              <div><input type="date" id="s-end" placeholder="End"></div>
            </div>
          </div>
        </div>
        <p class="hint">Fill this section at the beginning of the rotation.</p>
        <div class="btn-row"><button class="btn" onclick="saveAll()">Save</button></div>
      </div>

      <!-- Attendance -->
      <div class="tab-panel" id="tab-attendance">
        <h2>Attendance Record</h2>
        <p class="hint">Each training day should be logged. Time in/out may be confirmed by the supervisor.</p>
        <table id="attendance-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Time In</th>
              <th>Time Out</th>
              <th>Total Hours</th>
              <th>Supervisor Initials / Notes</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="btn-row">
          <button class="btn" onclick="addAttendanceRow()">Add Row</button>
          <button class="btn" onclick="saveAll()">Save</button>
        </div>
      </div>

      <!-- Case Log -->
      <div class="tab-panel" id="tab-cases">
        <h2>Case Log</h2>
        <p class="hint">Record important ultrasound cases (without patient identifiers). Focus on what you learned.</p>
        <table id="cases-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Exam Type</th>
              <th>Complexity Level</th>
              <th>Key Findings</th>
              <th>Reflection / Learning Point</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="btn-row">
          <button class="btn" onclick="addCaseRow()">Add Row</button>
          <button class="btn" onclick="saveAll()">Save</button>
        </div>
      </div>

      <!-- Weekly Reflections -->
      <div class="tab-panel" id="tab-weekly">
        <h2>Weekly Reflections</h2>
        <p class="hint">Short reflections for each week of the rotation.</p>
        <div id="weekly-wrap"></div>
        <div class="btn-row"><button class="btn" onclick="saveAll()">Save</button></div>
      </div>

      <!-- Mid-Rotation – Competency Checklists -->
      <div class="tab-panel" id="tab-mid">
        <h2>Mid-Rotation Competency Checklist (End of Week 2)</h2>
        <p class="hint">
          Supervisor: please use this checklist to document the student's progress. You may enter dates, ticks (✓), or short comments in the cells.
        </p>

        <h3>Machine Operation &amp; Knobology</h3>
        <table id="machine-table">
          <thead>
            <tr><th>Skill</th><th>Observed</th><th>Performed</th><th>Competent</th></tr>
          </thead>
          <tbody>
            <tr><td>Power system</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Select preset</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Probe selection</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Adjust depth</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Adjust gain</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Adjust TGC</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Set focus</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Freeze &amp; Cine</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Measurements</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Annotation</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Save image</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Disinfection</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          </tbody>
        </table>

        <h3>Abdominal Ultrasound Competency</h3>
        <table id="abdomen-table">
          <thead>
            <tr><th>Skill</th><th>Observed</th><th>Assisted</th><th>Performed</th><th>Competent</th></tr>
          </thead>
          <tbody>
            <tr><td>Liver</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Gallbladder</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Right kidney</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Left kidney</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Spleen</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Aorta / IVC</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Free fluid</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          </tbody>
        </table>

        <h3>Gynecologic Ultrasound Competency</h3>
        <table id="gyne-table">
          <thead>
            <tr><th>Skill</th><th>Observed</th><th>Assisted</th><th>Performed</th><th>Competent</th></tr>
          </thead>
          <tbody>
            <tr><td>Uterus</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Endometrium</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Ovaries</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Adnexa</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Common pathology</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          </tbody>
        </table>

        <h3>Obstetric Ultrasound Competency</h3>
        <table id="obs-table">
          <thead>
            <tr><th>Skill</th><th>Observed</th><th>Assisted</th><th>Performed</th><th>Competent</th></tr>
          </thead>
          <tbody>
            <tr><td>GS</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>CRL</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>FHR</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>BPD</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>HC</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>AC</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>FL</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Placenta</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>AFI</td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td><td><input type="text"></td></tr>
          </tbody>
        </table>

        <label>Supervisor Name &amp; Signature (typed)</label><input type="text" id="mid-supervisor">
        <div class="btn-row"><button class="btn" onclick="saveAll()">Save</button></div>
      </div>

      <!-- Final Evaluation -->
      <div class="tab-panel" id="tab-final">
        <h2>Final Evaluation</h2>
        <table id="final-table">
          <thead><tr><th>Domain</th><th>Score (1–5)</th><th>Comments</th></tr></thead>
          <tbody>
            <tr><td>Overall technical skill</td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Image interpretation</td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Clinical reasoning</td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Professionalism</td><td><input type="text"></td><td><input type="text"></td></tr>
            <tr><td>Teamwork & communication</td><td><input type="text"></td><td><input type="text"></td></tr>
          </tbody>
        </table>
        <label>Final Result (Pass / Fail / Incomplete)</label><input type="text" id="final-result">
        <label>Supervisor Name &amp; Signature (typed)</label><input type="text" id="final-supervisor">
        <label>Date</label><input type="date" id="final-date">
        <div class="btn-row"><button class="btn" onclick="saveAll()">Save</button></div>
      </div>

      <!-- Export / Save -->
      <div class="tab-panel" id="tab-export">
        <h2>Save / Submit Logbook</h2>
        <p class="hint">
          1. Click <b>Download Backup</b> to save a copy of your logbook data as a small text file (for your own records).<br>
          2. Click <b>Print / Save as PDF</b> to create the official logbook file and upload it in Moodle as required.
        </p>
        <div class="btn-row">
          <button class="btn" onclick="downloadBackup()">Download Backup</button>
          <button class="btn outline" onclick="window.print()">Print / Save as PDF</button>
          <button class="btn danger" onclick="resetAll()">Reset All Data</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const STORAGE_KEY = 'clinical_ultrasound_logbook_sinnar_v2';

  function init() {
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
      });
    });

    const attBody = document.querySelector('#attendance-table tbody');
    if(attBody.rows.length === 0) {
      for(let i=0;i<10;i++) addAttendanceRow();
    }

    const caseBody = document.querySelector('#cases-table tbody');
    if(caseBody.rows.length === 0) {
      for(let i=0;i<10;i++) addCaseRow();
    }

    const weeklyWrap = document.getElementById('weekly-wrap');
    weeklyWrap.innerHTML = '';
    for(let w=1; w<=4; w++) {
      const block = document.createElement('div');
      block.innerHTML = `
        <h3>Week ${w}</h3>
        <label>What I learned this week</label>
        <textarea data-week="${w}" data-field="learned"></textarea>
        <label>Challenges faced</label>
        <textarea data-week="${w}" data-field="challenges"></textarea>
        <label>How I will improve next week</label>
        <textarea data-week="${w}" data-field="improve"></textarea>
        <label>Supervisor comment (optional)</label>
        <textarea data-week="${w}" data-field="comments"></textarea>
      `;
      weeklyWrap.appendChild(block);
    }

    loadAll();
  }

  function addAttendanceRow(){
    const tbody = document.querySelector('#attendance-table tbody');
    const row = tbody.insertRow();
    const idx = row.rowIndex + 1;
    row.innerHTML = `
      <td>${idx}</td>
      <td><input type="date"></td>
      <td><input type="time"></td>
      <td><input type="time"></td>
      <td><input type="text"></td>
      <td><input type="text"></td>
    `;
  }

  function addCaseRow(){
    const tbody = document.querySelector('#cases-table tbody');
    const row = tbody.insertRow();
    const idx = row.rowIndex + 1;
    row.innerHTML = `
      <td>${idx}</td>
      <td><input type="date"></td>
      <td>
        <select>
          <option value="">Select</option>
          <option>Abdominal</option>
          <option>Gynecologic</option>
          <option>Obstetric</option>
          <option>Other</option>
        </select>
      </td>
      <td>
        <select>
          <option value="">Level</option>
          <option>Level 1 – Basic</option>
          <option>Level 2 – Moderate</option>
          <option>Level 3 – Challenging</option>
          <option>Level 4 – Complex</option>
        </select>
      </td>
      <td><input type="text"></td>
      <td><input type="text"></td>
    `;
  }

  function collectTable(sel){
    const rows = [];
    const tbody = document.querySelector(sel + ' tbody');
    if(!tbody) return rows;
    tbody.querySelectorAll('tr').forEach(tr => {
      const row = [];
      tr.querySelectorAll('td').forEach(td => {
        const inp = td.querySelector('input,select,textarea');
        row.push(inp ? inp.value : td.textContent.trim());
      });
      rows.push(row);
    });
    return rows;
  }

  function fillTable(sel, rows){
    const tbody = document.querySelector(sel + ' tbody');
    if(!tbody) return;
    tbody.innerHTML = '';
    rows.forEach((row, i) => {
      const tr = tbody.insertRow();
      row.forEach((val, j) => {
        const td = tr.insertCell();
        if(j === 0 && (sel === '#attendance-table' || sel === '#cases-table')) {
          td.textContent = (i+1);
        } else {
          if(sel === '#cases-table' && (j === 2 || j === 3)) {
            const selEl = document.createElement('select');
            if(j === 2) {
              selEl.innerHTML = '<option value="">Select</option><option>Abdominal</option><option>Gynecologic</option><option>Obstetric</option><option>Other</option>';
            } else {
              selEl.innerHTML = '<option value="">Level</option><option>Level 1 – Basic</option><option>Level 2 – Moderate</option><option>Level 3 – Challenging</option><option>Level 4 – Complex</option>';
            }
            selEl.value = val || '';
            td.appendChild(selEl);
          } else {
            const inp = document.createElement('input');
            inp.type = 'text';
            inp.value = val || '';
            td.appendChild(inp);
          }
        }
      });
    });
  }

  function saveAll(){
    const data = {};
    data.student = {
      name: document.getElementById('s-name').value,
      batch: document.getElementById('s-batch').value,
      number: document.getElementById('s-number').value,
      site: document.getElementById('s-site').value,
      supervisor: document.getElementById('s-supervisor').value,
      start: document.getElementById('s-start').value,
      end: document.getElementById('s-end').value
    };
    data.attendance = collectTable('#attendance-table');
    data.cases = collectTable('#cases-table');
    data.weekly = [];
    document.querySelectorAll('#weekly-wrap textarea').forEach(t => {
      const w = t.dataset.week;
      const f = t.dataset.field;
      if(!data.weekly[w-1]) data.weekly[w-1] = {week:w};
      data.weekly[w-1][f] = t.value;
    });
    data.mid = {
      machine: collectTable('#machine-table'),
      abdomen: collectTable('#abdomen-table'),
      gyne: collectTable('#gyne-table'),
      obstetric: collectTable('#obs-table'),
      supervisor: document.getElementById('mid-supervisor').value
    };
    data.final = {
      rows: collectTable('#final-table'),
      result: document.getElementById('final-result').value,
      supervisor: document.getElementById('final-supervisor').value,
      date: document.getElementById('final-date').value
    };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    alert('Logbook saved in this browser.');
  }

  function loadAll(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      if(data.student){
        document.getElementById('s-name').value = data.student.name || '';
        document.getElementById('s-batch').value = data.student.batch || '';
        document.getElementById('s-number').value = data.student.number || '';
        document.getElementById('s-site').value = data.student.site || '';
        document.getElementById('s-supervisor').value = data.student.supervisor || '';
        document.getElementById('s-start').value = data.student.start || '';
        document.getElementById('s-end').value = data.student.end || '';
      }
      if(data.attendance) fillTable('#attendance-table', data.attendance);
      if(data.cases) fillTable('#cases-table', data.cases);
      if(data.weekly){
        data.weekly.forEach(w => {
          ['learned','challenges','improve','comments'].forEach(f => {
            const ta = document.querySelector(`#weekly-wrap textarea[data-week="${w.week}"][data-field="${f}"]`);
            if(ta) ta.value = w[f] || '';
          });
        });
      }
      if(data.mid){
        if(data.mid.machine || data.mid.abdomen || data.mid.gyne || data.mid.obstetric){
          fillTable('#machine-table', data.mid.machine || []);
          fillTable('#abdomen-table', data.mid.abdomen || []);
          fillTable('#gyne-table', data.mid.gyne || []);
          fillTable('#obs-table', data.mid.obstetric || []);
        } else if(data.mid.rows){
          // Legacy single mid-rotation table: load into machine section
          fillTable('#machine-table', data.mid.rows || []);
        }
        document.getElementById('mid-supervisor').value = data.mid.supervisor || '';
      }
      if(data.final){
        fillTable('#final-table', data.final.rows || []);
        document.getElementById('final-result').value = data.final.result || '';
        document.getElementById('final-supervisor').value = data.final.supervisor || '';
        document.getElementById('final-date').value = data.final.date || '';
      }
    } catch(e) {
      console.error(e);
    }
  }

  function downloadBackup(){
    const data = localStorage.getItem(STORAGE_KEY) || '{}';
    const blob = new Blob([data], {type: "text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ultrasound_logbook_backup.txt';
    a.click();
    URL.revokeObjectURL(url);
  }

  function resetAll(){
    if(!confirm('This will clear all saved data in this browser for this logbook. Continue?')) return;
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }

  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
